# Workflow, detailed

01. Get pdb from last frame of trajectory. In VMD, make sure that
     (a) cell is aligned with axes 'pbc box -center origin'.
     (b) membrane is parallel to xy plane, perpendicular to z axis.

02. Move psf and pdb to 01_setup directory. In vim, edit mem_setup.tcl for the residue mutation, hybrid topology file, etc.

03. Edit .fep file:
     (a) In 00_main dir, create copy of name.pdb to name.fep.
     (b) In vim, search for "F2A" or whatever mutation it is.
     (c) Edit next to last column - the beta values for the changing residue.
         Just because F2A does NOT mean the beta value should be changed.
         Use 3rd column as a guide, atomtypes ending with A disappear (-1.00 value), 
            atomtypes ending with B are appearing (1.00 value).
         Hint: it might help to generate a temporary empty line before & after the -1 and 1 lines. 

04. In VMD, view name.fep file. "vmd file.psf -pdb file.fep". View with "source ../../../viewF2A.tcl".
     (*) Change residue number in Tcl script if necessary.
     (a) check cell alignment with axes. see code snippets below.
     (b) Red atoms are disappearing and blue atoms are appearing (set color Beta).
     (c) Also view in Licorice "all and within 3 of resname GBI1".

05. In 00_main file, edit alchemy.inp for periodic cell
     (a) cellBasisVectors can come from pdb of trajectory (not the pdb from psfgen)
     (b) ....  review all lines.

06. Edit simulation settings in slurm script.

07. Test a few jobs on nes partition (make sure files get read in correctly, etc.)

08. Submit using hybrid slurm script using "sbatch -N 8 file.slurm"
    (old) Submit entire array to ilg partition. 



VMD Code Snippets
  * measure center [atomselect top all] weight mass
  * set minmax [measure minmax [atomselect top all]]
  * molinfo top get {a b c}
  *   in graphical representations: abs(x)>48 or abs(y)>48
  * pbc box -center origin



Ligand Removal
  * vmdt -e file.pdb
  * set sel [atomselect top "not resname GBI1"]
  * $sel writepdb 15183_04_prot.pdb

  Also comment GBI-related lines in the script to generate the psf (mem_setup.tcl)


Additional resources:
  * https://github.com/limn1/DTT
  * NAMD FEP tutorial PDF and website

